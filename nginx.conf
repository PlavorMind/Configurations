user www-data; #linux_only
worker_processes auto;
events
{worker_connections 100;}
http
{include blacklist.conf;
include fastcgi_params;
include mime.types;
#Maximum client request content length (File size)
client_max_body_size 1G;
#Default MIME type of a response (Auto-generated by nginx)
default_type application/octet-stream;
#Error pages
error_page 403 /error/403.html;
error_page 404 /error/404.html;
error_page 500 /error/500.html;
error_page 501 /error/501.html;
error_page 502 /error/502.html;
error_page 503 /error/503.html;
error_page 504 /error/504.html;
#PHP FastCGI index
fastcgi_index index.php;
#Default PHP FastCGI script filename parameter
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#Index
index index.php index.html Main.php Main.html;
#Keep-alive connection timeout
keepalive_timeout 1m 1m;
#Allow sending files
sendfile on;
#Disable emitting nginx version
server_tokens off;

#Logs #linux_only

#Access log path #linux_only
access_log /etc/nginx/logs/access_log; #linux_only
#Error log path #linux_only
error_log /etc/nginx/logs/error_log;  #linux_only

#gzip #linux_only

#Enable gzipping #linux_only
gzip on; #linux_only
#Enable gzipping for all proxied requests #linux_only
gzip_proxied any; #linux_only
#Enable gzipping or responses for these MINE types #linux_only
gzip_types application/javascript application/json application/xml application/xml+rss text/css text/javascript text/plain text/xml; #linux_only
#Enable inserting "Vary: Accept-Encoding" response header #linux_only
gzip_vary on; #linux_only

#SSL

#Prefer server ciphers over client ciphers when using the SSLv3 and TLS protocols
ssl_prefer_server_ciphers on;
#SSL protocols
ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
#SSL session cache
ssl_session_cache shared:SSL:1m;
#SSL session timeout
ssl_session_timeout 1m;

server
  {listen 81;
  server_name _;
  root web/Main; #windows_only
  root /web/Main; #linux_only
  location /error/
    {allow all;}
  location /robots.txt
    {allow all;}
  location ~* \.php$
    {
    fastcgi_pass 127.0.0.1:90; #windows_only
    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #linux_only
    }
  }
server
  {listen 81;
  #listen 443 ssl;
  #ssl_certificate cert.pem;
  #ssl_certificate_key cert.key;
  server_name exit.nerdpol.ovh;
  root web/PlavorEXITBeta; #windows_only
  root /web/PlavorEXITBeta; #linux_only
  access_log logs/access_PlavorEXITBeta.txt; #windows_only
  access_log /etc/nginx/logs/access_PlavorEXITBeta; #linux_only
  error_log logs/error_PlavorEXITBeta.txt; #windows_only
  error_log /etc/nginx/logs/error_PlavorEXITBeta; #linux_only
  location /error/
    {allow all;}
  location /robots.txt
    {allow all;}
  location /mediawiki/images
    {}
  location /mediawiki/images/deleted
    {deny all;}
  location /mediawiki/logo.png
    {}
  location ~* ^\/mediawiki\/(extensions|skins)\/.*\.(bmp|css|gif|jpe?g|js(on)?|png|svg|tiff?)
    {try_files $uri =404;}
  location ~* ^\/mediawiki\/resources\/(assets|lib|src)\/.*\.png
    {try_files $uri =404;}
  location ~* \/(edit|history|page)\/User:PlavorSeol\/Private
    {allow 192.168.0.0/16;
    deny all;
    include fastcgi_params;
    fastcgi_pass 127.0.0.1:90; #windows_only
    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #linux_only
    fastcgi_param SCRIPT_FILENAME $document_root/mediawiki/index.php;}
  location /mediawiki/mw-config
    {allow 192.168.0.0/16;
    deny all;
    fastcgi_pass 127.0.0.1:90; #windows_only
    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #linux_only
    }
#Short URL
  location ~* \/(delete|edit|history|page|protect|purge|submit|unprotect)
    {include fastcgi_params;
    fastcgi_pass 127.0.0.1:90; #windows_only
    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #linux_only
    fastcgi_param SCRIPT_FILENAME $document_root/mediawiki/index.php;}
#Redirect to wiki
  location = /
    {rewrite ^/$ /page/;}
  location ~* \.php$
    {
    fastcgi_pass 127.0.0.1:90; #windows_only
    fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #linux_only
    }
  location /mediawiki
    {deny all;}
  }
}
