worker_processes auto;
events
{worker_connections 100;}
http
{include blacklist.conf;
include fastcgi_params;
include mime.types;
#Access log path (Linux only)
#access_log /etc/nginx/logs/access_log;
#Maximum client request content length (File size)
client_max_body_size 1G;
#Default MIME type of a response (Auto-generated by nginx)
default_type application/octet-stream;
#Error log path (Linux only)
#error_log /etc/nginx/logs/error_log;
#Error pages
error_page 403 /error/403.html;
error_page 404 /error/404.html;
error_page 500 /error/500.html;
error_page 501 /error/501.html;
error_page 502 /error/502.html;
error_page 503 /error/503.html;
error_page 504 /error/504.html;
#PHP FastCGI index
fastcgi_index index.php;
#Default PHP FastCGI script filename parameter
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#Enable gzipping (Linux only)
#gzip on;
#Enable gzipping for all proxied requests
gzip_proxied any;
#Enable gzipping or responses for these MINE types
gzip_types application/javascript application/json application/xml application/xml+rss text/css text/javascript text/plain text/xml;
#Enable inserting "Vary: Accept-Encoding" response header
gzip_vary on;
#Index
index index.php index.html Main.php Main.html;
#Keep-alive connection timeout
keepalive_timeout 1m 1m;
#Allow sending files
sendfile on;
#Disable emitting nginx version
server_tokens off;
#Prefer server ciphers over client ciphers when using the SSLv3 and TLS protocols
ssl_prefer_server_ciphers on;
#SSL protocols
ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;
#SSL session cache
ssl_session_cache shared:SSL:1m;
#SSL session timeout
ssl_session_timeout 1m;
server
  {listen 81;
  server_name _;
  root web/Main; #Windows only
  #root /web/Main; #Linux only
  location /error/403.html
    {allow all;}
  location /robots.txt
    {allow all;}
  location ~* \.php$
    {fastcgi_pass 127.0.0.1:90; #PHP-CGI
    #fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #PHP-FPM (Linux only)
    }
  }
server
  {listen 81;
  #listen 443 ssl;
  #ssl_certificate cert.pem;
  #ssl_certificate_key cert.key;
  server_name exit.nerdpol.ovh;
  root web/PlavorEXITBeta; #Windows only
  #root /web/PlavorEXITBeta; #Linux only
  #access_log /etc/nginx/logs/access_log_PlavorEXITBeta; #Linux only
  #error_log /etc/nginx/logs/error_log_PlavorEXITBeta; #Linux only
  location /error/403.html
    {allow all;}
  location /robots.txt
    {allow all;}
  location /mediawiki/images
    {}
  location /mediawiki/images/deleted
    {deny all;}
  location /mediawiki/logo.png
    {access_log off;}
  location ~* ^\/mediawiki\/(extensions|skins)\/.*\.(bmp|css|gif|jpe?g|js(on)?|png|svg|tiff?)
    {try_files $uri =404;}
  location ~* ^\/mediawiki\/resources\/(assets|lib|src)\/.*\.png
    {access_log off;
    try_files $uri =404;}
  location /mediawiki/mw-config
    {allow 192.168.0.0/16;
    deny all;
    fastcgi_pass 127.0.0.1:90; #PHP-CGI
    #fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #PHP-FPM (Linux only)
    }
#Short URL
  location ~* \/(delete|edit|history|page|protect|purge|unprotect)
    {include fastcgi_params;
    fastcgi_pass 127.0.0.1:90; #PHP-CGI
    #fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #PHP-FPM (Linux only)
    fastcgi_param SCRIPT_FILENAME $document_root/mediawiki/index.php;}
#Redirect to wiki
  location = /
    {rewrite ^/$ /page/;}
  location ~* \.php$
    {fastcgi_pass 127.0.0.1:90; #PHP-CGI
    #fastcgi_pass unix:/var/run/php/php7.2-fpm.sock; #PHP-FPM (Linux only)
    }
  location /mediawiki
    {deny all;}
  }
}
